<p-toast></p-toast>
<app-header></app-header>

<div class="register">
  <div class="container">
    <h1>Fill the details below to Register to NSDL</h1>
    <p>Please complete your registration by filling in the required details.</p>
    <div class="card">
      <p-stepper [value]="currentStep" [linear]="true">
        <p-step-list>
          <p-step [value]="1">Registration Details</p-step>
          <p-step [value]="2">Review Details</p-step>
          <p-step [value]="3">Email Verification</p-step>
          <p-step [value]="4">DDP Selection</p-step>
          <p-step [value]="5">Finish</p-step>
        </p-step-list>
        <p-step-panels>
          <p-step-panel [value]="1">
            <ng-template #content let-activateCallback="activateCallback">
              <p-card class="p-card">
                <form #loginForm="ngForm" class="login-form">
                  <h1>Sign Up</h1>

                  <!-- User Details -->
                  <div class="p-card-content">
                    <div class="main-header no-margin-bottom">
                      <div class="sign-up-header-icons">
                        <i class="pi pi-user icon-padding"></i>
                      </div>
                      <span>User Details</span>
                    </div>

                    <div class="user-wrapper">
                      <h4 id="userTypeLabel">
                        Register User As<span
                          style="color: #8f1709; margin-left: 0.5rem"
                          >*</span
                        >
                      </h4>
                      <div
                        class="user-sub-wrapper"
                        role="radiogroup"
                        aria-labelledby="userTypeLabel"
                        [ngClass]="{
                          'ng-invalid':
                            !userType &&
                            (loginForm.submitted || userTypeControl?.touched)
                        }"
                      >
                        <div class="radio">
                          <p-radiobutton
                            name="userType"
                            value="FPI Applicant"
                            inputId="fpiApplicant"
                            [(ngModel)]="userType"
                            #userTypeControl="ngModel"
                            (keydown)="
                              handleRadioKeydown(
                                $event,
                                'FPI Applicant',
                                'userType'
                              )
                            "
                            [tabindex]="0"
                          ></p-radiobutton>
                          <label for="fpiApplicant" class="radio-label"
                            >FPI Applicant</label
                          >
                        </div>
                        <div class="radio">
                          <p-radiobutton
                            name="userType"
                            value="Global Custodian"
                            inputId="globalCustodian"
                            [(ngModel)]="userType"
                            (keydown)="
                              handleRadioKeydown(
                                $event,
                                'Global Custodian',
                                'userType'
                              )
                            "
                            [tabindex]="0"
                          ></p-radiobutton>
                          <label for="globalCustodian" class="radio-label"
                            >Global Custodian</label
                          >
                        </div>
                      </div>
                      <p
                        *ngIf="
                          !userType &&
                          (loginForm.submitted || userTypeControl?.touched)
                        "
                        class="p-error"
                      >
                        Please select a user type.
                      </p>
                    </div>
                  </div>

                  <!-- FPI / Global Custodian Details -->
                  <div [ngSwitch]="userType">
                    <!-- FPI Applicant -->
                    <div *ngSwitchCase="'FPI Applicant'">
                      <div class="p-card-content">
                        <div
                          class="user-wrapper"
                          *ngIf="userType === 'FPI Applicant'"
                        >
                          <h4>
                            Are you an Individual applicant?<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </h4>
                          <div
                            class="fpiType-sub-wrapper"
                            [ngClass]="{
                              'ng-invalid':
                                !fpiType &&
                                (loginForm.submitted || fpiTypeControl?.touched)
                            }"
                          >
                            <div class="radio">
                              <p-radiobutton
                                name="fpiType"
                                value="yes"
                                inputId="fpiTypeYes"
                                [(ngModel)]="fpiType"
                                #fpiTypeControl="ngModel"
                                (keydown)="
                                  handleRadioKeydown($event, 'yes', 'fpiType')
                                "
                                [tabindex]="0"
                              ></p-radiobutton>
                              <label for="fpiTypeYes" class="radio-label"
                                >Yes</label
                              >
                            </div>
                            <div class="radio">
                              <p-radiobutton
                                name="fpiType"
                                value="no"
                                inputId="fpiTypeNo"
                                [(ngModel)]="fpiType"
                                (keydown)="
                                  handleRadioKeydown($event, 'no', 'fpiType')
                                "
                                [tabindex]="0"
                              ></p-radiobutton>
                              <label for="fpiTypeNo" class="radio-label"
                                >No</label
                              >
                            </div>
                          </div>
                          <p
                            *ngIf="
                              !fpiType &&
                              (loginForm.submitted || fpiTypeControl?.touched)
                            "
                            class="p-error"
                          >
                            Please select whether you are an individual
                            applicant.
                          </p>
                        </div>

                        <div [ngSwitch]="fpiType">
                          <!-- For Individual Applicant -->
                          <div *ngSwitchCase="'yes'">
                            <div class="address-wrapper">
                              <!-- Name of Organization / Company -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="organization-name"
                                    id="field-label"
                                  >
                                    Name of Organization / Company
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <input
                                  id="organization-name"
                                  name="organization-name"
                                  pInputText
                                  [(ngModel)]="userRegistration.entity_name"
                                  #organizationName="ngModel"
                                  [ngClass]="{
                                    'ng-dirty':
                                      organizationName.invalid &&
                                      (organizationName.touched ||
                                        organizationName.dirty)
                                  }"
                                  disabled
                                />
                                <p
                                  *ngIf="
                                    organizationName.invalid &&
                                    (organizationName.touched ||
                                      organizationName.dirty)
                                  "
                                  class="p-error"
                                >
                                  Name of organization / company is required.
                                </p>
                              </div>

                              <!-- User Name -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label for="user-name" id="field-label">
                                    User Name
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <input
                                  id="user-name"
                                  name="user-name"
                                  pInputText
                                  [(ngModel)]="
                                    userRegistration.user_name_fpi_app
                                  "
                                  #userNameFPI="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      userNameFPI.invalid &&
                                      (userNameFPI.touched || userNameFPI.dirty)
                                  }"
                                />
                                <p
                                  *ngIf="
                                    userNameFPI.invalid &&
                                    (userNameFPI.touched || userNameFPI.dirty)
                                  "
                                  class="p-error"
                                >
                                  User name is required.
                                </p>
                              </div>

                              <!-- Identity Issued by Authority -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="authority-issued-identifier"
                                    id="field-label"
                                  >
                                    Identity / Registration Issued by
                                    Authority<span class="text-danger">*</span>
                                  </label>
                                </div>
                                <p-select
                                  id="authority-issued-identifier"
                                  [options]="issuedIdentity"
                                  [(ngModel)]="selectedIssuedIdentity"
                                  optionLabel="name"
                                  name="authority-issued-identifier"
                                  #authorityIssuedIdentifier="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      authorityIssuedIdentifier.invalid &&
                                      (authorityIssuedIdentifier.touched ||
                                        authorityIssuedIdentifier.dirty)
                                  }"
                                ></p-select>
                                <p
                                  *ngIf="
                                    authorityIssuedIdentifier.invalid &&
                                    (authorityIssuedIdentifier.touched ||
                                      authorityIssuedIdentifier.dirty)
                                  "
                                  class="p-error"
                                >
                                  Please select an authority.
                                </p>
                              </div>

                              <!-- Other (please specify) -->
                              <div
                                *ngIf="
                                  selectedIssuedIdentity?.name ===
                                  'Other(please specify)'
                                "
                              >
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="authority-issued-identifier-other"
                                    id="field-label"
                                  >
                                    Other (Please Specify)
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <p-floatlabel variant="on">
                                  <input
                                    id="authority-issued-identifier-other"
                                    name="authority-issued-identifier-other"
                                    pInputText
                                    [(ngModel)]="userRegistration.specify_other"
                                    #authorityIssuedOther="ngModel"
                                    required
                                    [ngClass]="{
                                      'ng-dirty':
                                        authorityIssuedOther.invalid &&
                                        (authorityIssuedOther.touched ||
                                          authorityIssuedOther.dirty)
                                    }"
                                  />
                                </p-floatlabel>
                                <p
                                  *ngIf="
                                    authorityIssuedOther.invalid &&
                                    (authorityIssuedOther.touched ||
                                      authorityIssuedOther.dirty)
                                  "
                                  class="p-error"
                                >
                                  Please specify the other authority.
                                </p>
                              </div>

                              <!-- Number / Identifier -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="number-identifier"
                                    id="field-label"
                                  >
                                    Number / Identifier
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <input
                                  id="number-identifier"
                                  name="number-identifier"
                                  pInputText
                                  [(ngModel)]="userRegistration.specify_reg"
                                  #numberIdentifier="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      numberIdentifier.invalid &&
                                      (numberIdentifier.touched ||
                                        numberIdentifier.dirty)
                                  }"
                                />
                                <p
                                  *ngIf="
                                    numberIdentifier.invalid &&
                                    (numberIdentifier.touched ||
                                      numberIdentifier.dirty)
                                  "
                                  class="p-error"
                                >
                                  Number / identifier is required.
                                </p>
                              </div>

                              <!-- Date Of Birth -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label for="date-of-birth" id="field-label">
                                    Date Of Birth
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <p-datepicker
                                  id="date-of-birth"
                                  name="date-of-birth"
                                  class="full-width"
                                  [iconDisplay]="'input'"
                                  [showIcon]="true"
                                  dateFormat="dd/mm/yy"
                                  [(ngModel)]="userRegistration.dob"
                                  #dateOfBirth="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty ng-invalid':
                                      dateOfBirth.invalid &&
                                      (dateOfBirth.touched || dateOfBirth.dirty)
                                  }"
                                ></p-datepicker>
                                <p
                                  *ngIf="
                                    dateOfBirth.invalid &&
                                    (dateOfBirth.touched || dateOfBirth.dirty)
                                  "
                                  class="p-error"
                                >
                                  Date of birth is required.
                                </p>
                              </div>
                            </div>
                          </div>

                          <!-- For Non-Individual Applicant -->
                          <div *ngSwitchCase="'no'">
                            <div class="address-wrapper">
                              <!-- Organization / Company Name -->
                              <!-- Name of the Organization / Company -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="organisation-name"
                                    id="field-label"
                                  >
                                    Name of the Organization / Company
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <input
                                  id="organisation-name"
                                  name="organisation-name"
                                  pInputText
                                  [(ngModel)]="userRegistration.entity_name"
                                  #organisationName="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      organisationName.invalid &&
                                      (organisationName.touched ||
                                        organisationName.dirty)
                                  }"
                                />
                                <p
                                  *ngIf="
                                    organisationName.invalid &&
                                    (organisationName.touched ||
                                      organisationName.dirty)
                                  "
                                  class="p-error"
                                >
                                  Organization/company name is required.
                                </p>
                              </div>

                              <!-- User Name -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label for="user-name" id="field-label">
                                    Name of User
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <input
                                  id="user-name"
                                  name="user-name"
                                  pInputText
                                  [(ngModel)]="
                                    userRegistration.user_name_fpi_app
                                  "
                                  #userNameNonFPI="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      userNameNonFPI.invalid &&
                                      (userNameNonFPI.touched ||
                                        userNameNonFPI.dirty)
                                  }"
                                />
                                <p
                                  *ngIf="
                                    userNameNonFPI.invalid &&
                                    (userNameNonFPI.touched ||
                                      userNameNonFPI.dirty)
                                  "
                                  class="p-error"
                                >
                                  User name is required.
                                </p>
                              </div>

                              <!-- Residency / Registration Number -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="residency-registration-number"
                                    id="field-label"
                                  >
                                    Specify LEI Residency or Registration Number
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <p-select
                                  id="residency-registration-number"
                                  [options]="residencyRegistrationNumber"
                                  [(ngModel)]="
                                    selectedResidencyRegistrationNumber
                                  "
                                  optionLabel="name"
                                  name="residency-registration-number"
                                  #residencyRegNumber="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      residencyRegNumber.invalid &&
                                      (residencyRegNumber.touched ||
                                        residencyRegNumber.dirty)
                                  }"
                                ></p-select>
                                <p
                                  *ngIf="
                                    residencyRegNumber.invalid &&
                                    (residencyRegNumber.touched ||
                                      residencyRegNumber.dirty)
                                  "
                                  class="p-error"
                                >
                                  Please select a residency/registration number.
                                </p>
                              </div>

                              <!-- Other (please specify) for Residency -->
                              <div
                                *ngIf="
                                  selectedResidencyRegistrationNumber?.name ===
                                  'Other(please specify)'
                                "
                              >
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="residency-registration-number-other"
                                  >
                                    Other (Please Specify)
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <p-floatlabel variant="on">
                                  <input
                                    id="residency-registration-number-other"
                                    name="residency-registration-number-other"
                                    pInputText
                                    [(ngModel)]="userRegistration.specify_other"
                                    #residencyOther="ngModel"
                                    required
                                    [ngClass]="{
                                      'ng-dirty':
                                        residencyOther.invalid &&
                                        (residencyOther.touched ||
                                          residencyOther.dirty)
                                    }"
                                  />
                                </p-floatlabel>
                                <p
                                  *ngIf="
                                    residencyOther.invalid &&
                                    (residencyOther.touched ||
                                      residencyOther.dirty)
                                  "
                                  class="p-error"
                                >
                                  Please specify the other
                                  residency/registration number.
                                </p>
                              </div>

                              <!-- Number / Identifier -->
                              <div>
                                <div style="margin-bottom: 0.5rem">
                                  <label
                                    for="number-identifier"
                                    id="field-label"
                                  >
                                    Number / Identifier
                                    <span class="text-danger">*</span>
                                  </label>
                                </div>
                                <input
                                  id="number-identifier"
                                  name="number-identifier"
                                  pInputText
                                  [(ngModel)]="userRegistration.lei_reg_no"
                                  #numberIdentifierNonFPI="ngModel"
                                  required
                                  [ngClass]="{
                                    'ng-dirty':
                                      numberIdentifierNonFPI.invalid &&
                                      (numberIdentifierNonFPI.touched ||
                                        numberIdentifierNonFPI.dirty)
                                  }"
                                />
                                <p
                                  *ngIf="
                                    numberIdentifierNonFPI.invalid &&
                                    (numberIdentifierNonFPI.touched ||
                                      numberIdentifierNonFPI.dirty)
                                  "
                                  class="p-error"
                                >
                                  Number / identifier is required.
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Global Custodian -->
                    <div *ngSwitchCase="'Global Custodian'">
                      <div class="p-card-content">
                        <div class="address-wrapper">
                          <!-- Global Custodian Name -->
                          <div>
                            <div style="margin-bottom: 0.5rem">
                              <label
                                for="global-custodian-name"
                                id="field-label"
                              >
                                Name of Global Custodian
                                <span
                                  style="color: #8f1709; margin-left: 0.5rem"
                                  >*</span
                                >
                              </label>
                            </div>
                            <input
                              id="global-custodian-name"
                              name="global-custodian-name"
                              pInputText
                              [(ngModel)]="userRegistration.gc_name"
                              #gcName="ngModel"
                              required
                              [ngClass]="{
                                'ng-dirty':
                                  gcName.invalid &&
                                  (gcName.touched || gcName.dirty)
                              }"
                            />
                            <p
                              *ngIf="
                                gcName.invalid &&
                                (gcName.touched || gcName.dirty)
                              "
                              class="p-error"
                            >
                              Global custodian name is required.
                            </p>
                          </div>

                          <!-- Global Custodian Registration Number -->
                          <div>
                            <div style="margin-bottom: 0.5rem">
                              <label
                                for="global-custodian-registration-number"
                                id="field-label"
                              >
                                Registration Number of Global Custodian
                                <span
                                  style="color: #8f1709; margin-left: 0.5rem"
                                  >*</span
                                >
                              </label>
                            </div>
                            <input
                              id="global-custodian-registration-number"
                              name="global-custodian-registration-number"
                              pInputText
                              [(ngModel)]="userRegistration.gc_reg_no"
                              #gcRegNo="ngModel"
                              required
                              [ngClass]="{
                                'ng-dirty':
                                  gcRegNo.invalid &&
                                  (gcRegNo.touched || gcRegNo.dirty)
                              }"
                            />
                            <p
                              *ngIf="
                                gcRegNo.invalid &&
                                (gcRegNo.touched || gcRegNo.dirty)
                              "
                              class="p-error"
                            >
                              Registration number is required.
                            </p>
                          </div>

                          <!-- Global Custodian User Name -->
                          <div>
                            <div style="margin-bottom: 0.5rem">
                              <label
                                for="global-custodian-name-of-user"
                                id="field-label"
                              >
                                Name of the User
                                <span
                                  style="color: #8f1709; margin-left: 0.5rem"
                                  >*</span
                                >
                              </label>
                            </div>
                            <input
                              id="global-custodian-name-of-user"
                              name="global-custodian-name-of-user"
                              pInputText
                              [(ngModel)]="userRegistration.gc_name_of_user"
                              #gcUserName="ngModel"
                              required
                              [ngClass]="{
                                'ng-dirty':
                                  gcUserName.invalid &&
                                  (gcUserName.touched || gcUserName.dirty)
                              }"
                            />
                            <p
                              *ngIf="
                                gcUserName.invalid &&
                                (gcUserName.touched || gcUserName.dirty)
                              "
                              class="p-error"
                            >
                              User name is required.
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Address & Communication Details -->
                  <div class="p-card-content">
                    <div class="main-header">
                      <div class="sign-up-header-icons">
                        <i class="pi pi-address-book icon-padding"></i>
                      </div>
                      <span>Address & Communication Details</span>
                    </div>

                    <div class="address-wrapper">
                      <!-- City -->
                      <!-- City -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="city">
                            City<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <input
                          id="city"
                          name="city"
                          pInputText
                          [(ngModel)]="userRegistration.city"
                          #city="ngModel"
                          required
                          [ngClass]="{
                            'ng-dirty':
                              city.invalid && (city.touched || city.dirty)
                          }"
                        />
                        <p
                          *ngIf="city.invalid && (city.touched || city.dirty)"
                          class="p-error"
                        >
                          City is required.
                        </p>
                      </div>

                      <!-- State -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="state">
                            State<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <input
                          id="state"
                          name="state"
                          pInputText
                          [(ngModel)]="userRegistration.state"
                          #state="ngModel"
                          required
                          [ngClass]="{
                            'ng-dirty':
                              state.invalid && (state.touched || state.dirty)
                          }"
                        />
                        <p
                          *ngIf="
                            state.invalid && (state.touched || state.dirty)
                          "
                          class="p-error"
                        >
                          State is required.
                        </p>
                      </div>

                      <!-- Zip Code -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="zip">
                            Zip Code<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <input
                          id="pincode"
                          name="pincode"
                          pInputText
                          [(ngModel)]="userRegistration.pincode"
                          #pincode="ngModel"
                          required
                          [ngClass]="{
                            'ng-dirty':
                              pincode.invalid &&
                              (pincode.touched || pincode.dirty)
                          }"
                          style="width: 100%"
                          type="text"
                        />
                        <p
                          *ngIf="
                            pincode.invalid &&
                            (pincode.touched || pincode.dirty)
                          "
                          class="p-error"
                        >
                          Zip code is required.
                        </p>
                      </div>

                      <!-- Country -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="country">
                            Country<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <p-select
                          id="country"
                          [options]="countries"
                          [(ngModel)]="selectedCountry"
                          (ngModelChange)="onCountryChange($event)"
                          optionLabel="name"
                          name="country"
                          [filter]="true"
                          filterBy="name"
                          [showClear]="true"
                          required
                          #country="ngModel"
                          [ngClass]="{
                            'ng-dirty':
                              country.invalid &&
                              (country.touched || country.dirty)
                          }"
                        ></p-select>
                        <p
                          *ngIf="
                            country.invalid &&
                            (country.touched || country.dirty)
                          "
                          class="p-error"
                        >
                          Country is required.
                        </p>
                      </div>

                      <!-- Mobile Number -->
                      <div>
                        <div
                          style="
                            display: flex;
                            flex-direction: column;
                            gap: 0.5rem;
                          "
                        >
                          <label id="field-label" for="password">
                            Mobile Number<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <div style="display: flex">
                          <p-select
                            id="country-code"
                            [options]="countryCodes"
                            [(ngModel)]="selectedCountryCode"
                            optionLabel="code"
                            name="countryCode"
                            [filter]="true"
                            filterBy="code"
                            [style]="{
                              'border-top-right-radius': '0',
                              'border-bottom-right-radius': '0',
                              'border-right': 'none',
                              'font-weight': '100'
                            }"
                            required
                            #countryCode="ngModel"
                            [ngClass]="{
                              'ng-dirty':
                                countryCode.invalid &&
                                (countryCode.touched || countryCode.dirty)
                            }"
                            [disabled]="true"
                          >
                            <ng-template pTemplate="item" let-country>
                              <div>
                                <span>{{ country.code }}</span>
                              </div>
                            </ng-template>
                          </p-select>
                          <input
                            id="mno"
                            name="mno"
                            pInputText
                            class="input-no-left-border"
                            [(ngModel)]="userRegistration.number"
                            required
                            #mno="ngModel"
                            [ngClass]="{
                              'ng-dirty':
                                mno.invalid && (mno.touched || mno.dirty)
                            }"
                            type="text"
                          />
                        </div>
                        <p
                          *ngIf="
                            (countryCode.invalid &&
                              (countryCode.touched || countryCode.dirty)) ||
                            (mno.invalid && (mno.touched || mno.dirty))
                          "
                          class="p-error"
                        >
                          Mobile number is required.
                        </p>
                      </div>

                      <!-- Area / STD Code -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="area">
                            Area / STD Code<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <input
                          id="area"
                          name="area"
                          pInputText
                          [(ngModel)]="userRegistration.area_code"
                          required
                          #area="ngModel"
                          [ngClass]="{
                            'ng-dirty':
                              area.invalid && (area.touched || area.dirty)
                          }"
                          type="text"
                        />
                        <p
                          *ngIf="area.invalid && (area.touched || area.dirty)"
                          class="p-error"
                        >
                          Area / std code is required.
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Login/User Credentials -->
                  <div class="p-card-content">
                    <div class="main-header">
                      <div class="sign-up-header-icons">
                        <i class="pi pi-sign-in icon-padding"></i>
                      </div>
                      <span>Login/User Credentials</span>
                    </div>
                    <div class="credential-wrapper">
                      <!-- Email Id -->
                      <!-- Email Id -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="userid">
                            Email Id<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <input
                          id="userid"
                          name="userid"
                          pInputText
                          [(ngModel)]="userRegistration.email_id"
                          #emailCtrl="ngModel"
                          required
                          [ngClass]="{
                            'ng-dirty':
                              emailCtrl.invalid &&
                              (emailCtrl.touched || emailCtrl.dirty)
                          }"
                        />
                        <p
                          *ngIf="
                            emailCtrl.invalid &&
                            (emailCtrl.touched || emailCtrl.dirty)
                          "
                          class="p-error"
                        >
                          Email Id is required.
                        </p>
                      </div>

                      <!-- Password -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="password">
                            Password<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <div>
                          <p-password
                            [(ngModel)]="password"
                            #passwordCtrl="ngModel"
                            [feedback]="false"
                            [toggleMask]="true"
                            name="password"
                            (ngModelChange)="validatePassword($event)"
                            required
                            [pTooltip]="tooltipContent"
                            [escape]="false"
                            tooltipPosition="right"
                            [tooltipStyleClass]="'password-tooltip'"
                            [ngClass]="{
                              'ng-dirty':
                                passwordCtrl.invalid &&
                                (passwordCtrl.touched || passwordCtrl.dirty)
                            }"
                          ></p-password>
                          <ng-template #tooltipContent>
                            <div class="validation-messages">
                              <div
                                class="validation-item"
                                [style.color]="
                                  passwordValidation.minLength
                                    ? '#4caf50'
                                    : '#dc3545'
                                "
                              >
                                <i
                                  [class]="
                                    passwordValidation.minLength
                                      ? 'pi pi-check'
                                      : 'pi pi-times'
                                  "
                                ></i>
                                Minimum 8 characters
                              </div>
                              <div
                                class="validation-item"
                                [style.color]="
                                  passwordValidation.hasUpperCase
                                    ? '#4caf50'
                                    : '#dc3545'
                                "
                              >
                                <i
                                  [class]="
                                    passwordValidation.hasUpperCase
                                      ? 'pi pi-check'
                                      : 'pi pi-times'
                                  "
                                ></i>
                                One uppercase letter
                              </div>
                              <div
                                class="validation-item"
                                [style.color]="
                                  passwordValidation.hasLowerCase
                                    ? '#4caf50'
                                    : '#dc3545'
                                "
                              >
                                <i
                                  [class]="
                                    passwordValidation.hasLowerCase
                                      ? 'pi pi-check'
                                      : 'pi pi-times'
                                  "
                                ></i>
                                One lowercase letter
                              </div>
                              <div
                                class="validation-item"
                                [style.color]="
                                  passwordValidation.hasNumber
                                    ? '#4caf50'
                                    : '#dc3545'
                                "
                              >
                                <i
                                  [class]="
                                    passwordValidation.hasNumber
                                      ? 'pi pi-check'
                                      : 'pi pi-times'
                                  "
                                ></i>
                                One number
                              </div>
                              <div
                                class="validation-item"
                                [style.color]="
                                  passwordValidation.hasSpecialChar
                                    ? '#4caf50'
                                    : '#dc3545'
                                "
                              >
                                <i
                                  [class]="
                                    passwordValidation.hasSpecialChar
                                      ? 'pi pi-check'
                                      : 'pi pi-times'
                                  "
                                ></i>
                                One special character
                              </div>
                            </div>
                          </ng-template>
                          <p
                            *ngIf="
                              passwordCtrl.invalid &&
                              (passwordCtrl.touched || passwordCtrl.dirty)
                            "
                            class="p-error"
                          >
                            Password is required.
                          </p>
                        </div>
                      </div>

                      <!-- Confirm Password -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="confirmPassword">
                            Confirm Password<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <div class="column-gap">
                          <p-password
                            [(ngModel)]="confirmPassword"
                            #confirmPasswordCtrl="ngModel"
                            [toggleMask]="true"
                            [feedback]="false"
                            name="confirmPassword"
                            class="confirmPassword"
                            required
                            [ngClass]="{
                              'ng-dirty':
                                confirmPasswordCtrl.invalid &&
                                (confirmPasswordCtrl.touched ||
                                  confirmPasswordCtrl.dirty)
                            }"
                          ></p-password>
                          <small
                            class="p-error error-text"
                            *ngIf="confirmPassword && !passwordsMatch()"
                          >
                            Passwords do not match
                          </small>
                          <p
                            *ngIf="
                              confirmPasswordCtrl.invalid &&
                              (confirmPasswordCtrl.touched ||
                                confirmPasswordCtrl.dirty)
                            "
                            class="p-error"
                          >
                            Confirm Password is required.
                          </p>
                        </div>
                      </div>

                      <!-- Captcha Input Field -->
                      <div>
                        <div style="margin-bottom: 0.5rem">
                          <label id="field-label" for="captcha">
                            Captcha<span
                              style="color: #8f1709; margin-left: 0.5rem"
                              >*</span
                            >
                          </label>
                        </div>
                        <input
                          id="captcha"
                          name="captcha"
                          pInputText
                          [(ngModel)]="captchaInput"
                          #captchaInputCtrl="ngModel"
                          required
                          [ngClass]="{
                            'ng-dirty':
                              captchaInputCtrl.invalid &&
                              (captchaInputCtrl.touched ||
                                captchaInputCtrl.dirty)
                          }"
                        />
                        <p
                          *ngIf="
                            captchaInputCtrl.invalid &&
                            (captchaInputCtrl.touched || captchaInputCtrl.dirty)
                          "
                          class="p-error"
                        >
                          Captcha is required.
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Bottom Buttons for Step 1 -->
                  <div class="captcha-wrapper">
                    <p>Captcha</p>
                    <img [src]="captcha" alt="captcha" />
                    <div
                      class="refresh"
                      (click)="refreshCaptcha()"
                      (keypress)="refreshCaptcha()"
                    >
                      <i
                        class="pi pi-refresh refresh-icon"
                        [ngStyle]="{
                          transform: 'rotate(' + rotationDegree + 'deg)'
                        }"
                      ></i>
                    </div>
                    <button class="reset" type="button" (click)="resetForm()">
                      Reset
                    </button>
                    <button
                      class="next-button"
                      (click)="onNext(activateCallback)"
                      type="button"
                    >
                      Next
                    </button>
                  </div>
                </form>
              </p-card>
            </ng-template>
          </p-step-panel>

          <!-- Step 2: Review Details -->
          <p-step-panel [value]="2">
            <ng-template #content let-activateCallback="activateCallback">
              <p-card class="p-card" id="review-details">
                <form #loginForm="ngForm" class="login-form">
                  <h1>Review Details</h1>
                  <div class="p-card-content">
                    <div class="main-header">
                      <div class="sign-up-header-icons">
                        <i class="pi pi-user icon-padding"></i>
                      </div>
                      <span>User Details</span>
                    </div>

                    <div>
                      <!-- For FPI Applicant - Individual -->
                      <div
                        *ngIf="
                          userType === 'FPI Applicant' && fpiType === 'yes'
                        "
                        class="address-wrapper"
                      >
                        <span>
                          <label for="userType">User Type</label>
                          <p id="review-details-p">Individual FPI Applicant</p>
                        </span>
                        <span>
                          <label for="userName">User Name</label>
                          <p id="review-details-p">
                            {{ userRegistration.user_name_fpi_app }}
                          </p>
                        </span>
                        <span>
                          <label for="selectedIssuedIdentity"
                            >Identity Issued by Authority</label
                          >
                          <p id="review-details-p">
                            {{ selectedIssuedIdentity?.name }}
                          </p>
                        </span>
                        <span
                          *ngIf="
                            selectedIssuedIdentity?.name ===
                            'Other(please specify)'
                          "
                        >
                          <label for="specify_other">Other Authority</label>
                          <p id="review-details-p">
                            {{ userRegistration.specify_other }}
                          </p>
                        </span>
                        <span>
                          <label for="specify_reg">Number/Identifier</label>
                          <p id="review-details-p">
                            {{ userRegistration.specify_reg }}
                          </p>
                        </span>
                        <span>
                          <label for="dob">Date of Birth</label>
                          <p id="review-details-p">
                            {{ userRegistration.dob | date : "dd/MM/yyyy" }}
                          </p>
                        </span>
                      </div>

                      <!-- For FPI Applicant - Non-Individual -->
                      <div
                        *ngIf="userType === 'FPI Applicant' && fpiType === 'no'"
                        class="address-wrapper"
                      >
                        <span>
                          <label for="userType">User Type</label>
                          <p>Non-Individual FPI Applicant</p>
                        </span>
                        <span>
                          <label for="entity_name"
                            >Organization/Company Name</label
                          >
                          <p id="review-details-p">
                            {{ userRegistration.entity_name }}
                          </p>
                        </span>
                        <span>
                          <label for="user_name_fpi_app">User Name</label>
                          <p id="review-details-p">
                            {{ userRegistration.user_name_fpi_app }}
                          </p>
                        </span>
                        <span>
                          <label for="name">LEI/Registration Type</label>
                          <p id="review-details-p">
                            {{ selectedResidencyRegistrationNumber?.name }}
                          </p>
                        </span>
                        <span
                          *ngIf="
                            selectedResidencyRegistrationNumber?.name ===
                            'Other(please specify)'
                          "
                        >
                          <label for="specify_other"
                            >Other Registration Type</label
                          >
                          <p id="review-details-p">
                            {{ userRegistration.specify_other }}
                          </p>
                        </span>
                        <span>
                          <label for="specify_reg">Number/Identifier</label>
                          <p id="review-details-p">
                            {{ userRegistration.specify_reg }}
                          </p>
                        </span>
                      </div>

                      <!-- For Global Custodian -->
                      <div
                        *ngIf="userType === 'Global Custodian'"
                        class="address-wrapper"
                      >
                        <span>
                          <label for="gc">User Type</label>
                          <p id="review-details-p">Global Custodian</p>
                        </span>
                        <span>
                          <label for="gn_name">Global Custodian Name</label>
                          <p id="review-details-p">
                            {{ userRegistration.gc_name }}
                          </p>
                        </span>
                        <span>
                          <label for="gc_reg_no">Registration Number</label>
                          <p id="review-details-p">
                            {{ userRegistration.gc_reg_no }}
                          </p>
                        </span>
                        <span>
                          <label for="gc_name_of_user">User Name</label>
                          <p id="review-details-p">
                            {{ userRegistration.gc_name_of_user }}
                          </p>
                        </span>
                      </div>
                    </div>
                  </div>

                  <div class="p-card-content">
                    <div class="main-header">
                      <div class="sign-up-header-icons">
                        <i class="pi pi-address-book icon-padding"></i>
                      </div>
                      <span>Address & Communication Details</span>
                    </div>

                    <div class="address-wrapper">
                      <span>
                        <label for="city">City</label>
                        <p id="review-details-p">{{ userRegistration.city }}</p>
                      </span>
                      <span>
                        <label for="state">State</label>
                        <p id="review-details-p">
                          {{ userRegistration.state }}
                        </p>
                      </span>
                      <span>
                        <label for="zip">Zip Code</label>
                        <p id="review-details-p">
                          {{ userRegistration.pincode }}
                        </p>
                      </span>
                      <span>
                        <label for="country">Country</label>
                        <p id="review-details-p">{{ selectedCountry.name }}</p>
                      </span>
                      <span>
                        <label for="mno">Mobile Number</label>
                        <p id="review-details-p">
                          {{ selectedCountryCode.code }}
                          {{ userRegistration.number }}
                        </p>
                      </span>
                      <span>
                        <label for="area">Area/STD Code</label>
                        <p id="review-details-p">
                          {{ userRegistration.area_code }}
                        </p>
                      </span>
                    </div>
                  </div>

                  <div class="p-card-content">
                    <div class="main-header">
                      <div class="sign-up-header-icons">
                        <i class="pi pi-sign-in icon-padding"></i>
                      </div>
                      <span>Login/User Credentials</span>
                    </div>

                    <div class="credential-wrapper">
                      <span>
                        <label for="userid">UserID</label>
                        <p id="review-details-p">
                          {{ userRegistration.email_id }}
                        </p>
                      </span>
                    </div>
                  </div>

                  <div class="button-wrapper">
                    <button
                      class="reset"
                      (click)="backToStep(activateCallback, 1)"
                      type="button"
                    >
                      Back
                    </button>
                    <button
                      type="button"
                      (click)="registerUser(activateCallback)"
                      class="next-button"
                    >
                      Next
                    </button>
                  </div>
                </form>
              </p-card>
            </ng-template>
          </p-step-panel>

          <!-- Step 3: Email Verification -->
          <p-step-panel [value]="3">
            <ng-template #content let-activateCallback="activateCallback">
              <p-card class="p-card">
                <div
                  style="
                    display: flex;
                    flex-direction: column;
                    gap: 3rem;
                    justify-content: center;
                  "
                >
                  <div>
                    <h1>Email Verification</h1>
                    <div style="margin-bottom: 0.5rem">
                      <label id="field-label">
                        An OTP has been sent to {{ userRegistration.email_id }}.
                        Please enter it below to continue to register.
                      </label>
                    </div>
                    <div
                      style="
                        align-items: center;
                        justify-content: center;
                        display: flex;
                        margin-top: 1.8rem;
                      "
                    >
                      <p-inputOtp
                        #otpInput="ngModel"
                        name="otp"
                        [length]="otpLength"
                        [(ngModel)]="otp"
                        (ngModelChange)="onOtpChange($event, activateCallback)"
                        class="otp-gap"
                      >
                        <ng-template
                          pTemplate="input"
                          let-token
                          let-events="events"
                          let-index="index"
                        >
                          <input
                            pInputText
                            type="text"
                            id="otp"
                            class="custom-otp-input form-control otp-input"
                            autofocus
                            [maxLength]="1"
                            [attr.value]="token"
                            (input)="events.input($event)"
                            (keydown)="events.keydown($event)"
                            required
                          />
                          <div *ngIf="index === 3" class="otp-separator">
                            <i class="pi pi-minus"></i>
                          </div>
                        </ng-template>
                      </p-inputOtp>
                    </div>
                  </div>
                  <div class="button-wrapper">
                    <button
                      class="resend-button"
                      [class.disabled]="isDisabled"
                      type="button"
                      (click)="triggerOtp()"
                      [disabled]="isDisabled"
                    >
                      <span style="color: white; margin-right: 0.5rem">
                        {{
                          isDisabled
                            ? "Resend " +
                              (countdownMinutes | number : "2.0") +
                              ":" +
                              (countdownSeconds | number : "2.0")
                            : "Resend"
                        }}
                      </span>
                      <i class="pi pi-sync"></i>
                    </button>
                    <button
                      type="button"
                      class="next-button"
                      [disabled]="otpInput.invalid"
                      (click)="verifyOtp(activateCallback)"
                      (keyPress)="verifyOtp(activateCallback)"
                    >
                      Next
                    </button>
                  </div>
                </div>
              </p-card>
            </ng-template>
          </p-step-panel>

          <!-- Step 4: DDP Selection -->
          <p-step-panel [value]="4">
            <ng-template #content let-activateCallback="activateCallback">
              <p-card class="p-card">
                <div style="display: flex; flex-direction: column; gap: 3rem">
                  <div>
                    <h1>DDP Selection</h1>
                    <div style="margin-bottom: 0.5rem">
                      <label id="field-label">
                        Please select your DDP from the list below.
                      </label>
                    </div>
                    <p-select
                      id="ddp"
                      [options]="ddps"
                      [(ngModel)]="selectedDdp"
                      optionLabel="ddp_name"
                      placeholder="Select DDP"
                      [filter]="true"
                      filterBy="name"
                      class="full-width"
                    ></p-select>
                  </div>
                  <div class="button-wrapper">
                    <button
                      class="reset"
                      (click)="backToStep(activateCallback, 3)"
                      type="button"
                    >
                      Back
                    </button>
                    <button
                      (click)="updateSelectedDDP(activateCallback)"
                      class="next-button"
                      type="button"
                    >
                      Next
                    </button>
                  </div>
                </div>
              </p-card>
            </ng-template>
          </p-step-panel>

          <!-- Step 5: Finish -->
          <p-step-panel [value]="5">
            <ng-template #content let-activateCallback="activateCallback">
              <p-card class="p-card">
                <div class="finish">
                  <h2>
                    Congratulations you have been registered to NSDL Portal
                  </h2>
                  <h3 id="field-label">Login Now to access your account</h3>
                  <img [src]="tick" alt="tick" />
                  <a
                    routerLink="/auth/login"
                    type="button"
                    pButton
                    pRipple
                    class="login"
                    >Login</a
                  >
                </div>
              </p-card>
            </ng-template>
          </p-step-panel>
        </p-step-panels>
      </p-stepper>
    </div>
  </div>
</div>
<app-footer></app-footer>
<app-loader *ngIf="showLoader"></app-loader>
